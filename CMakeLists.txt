cmake_minimum_required(VERSION 3.1 FATAL_ERROR)
project (ELITPC_DCS)
set (CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g3 -fno-inline -Wall -Wno-unused-function")
set(EXECUTABLE_OUTPUT_PATH ${CMAKE_BINARY_DIR}/bin)
set(open62541_LIB $ENV{open62541_LIB})
set(CMAKE_INSTALL_RPATH ${CMAKE_INSTALL_PREFIX}/lib:${open62541_LIB})
MESSAGE( STATUS "CMAKE_INSTALL_PREFIX:\t\t" ${CMAKE_INSTALL_PREFIX} )
MESSAGE( STATUS "CMAKE_INSTALL_RPATH:\t\t" ${CMAKE_INSTALL_RPATH} )
find_package(open62541 REQUIRED)
if(open62541_FOUND AND open62541_LIB)
    option(BUILD_SERVER "build server" ON)
    option(BUILD_DB "build database client" ON)
    option(BUILD_GUI "build operational client with gui" ON) 
    option(BUILD_TEST "build simple tests" ON) 
    add_subdirectory(deps)
    add_subdirectory(COREdcs)
    add_subdirectory(ELITPCdcs)
    if(BUILD_TEST)
        add_subdirectory(test)
    endif()
    install(FILES $<1:${PROJECT_SOURCE_DIR}/docs/img/> DESTINATION icon)
    install(DIRECTORY DESTINATION $ENV{HOME}/.dcs)
else()
    MESSAGE(WARNING "Missing parts of open62541. Try '. env.sh'")
endif()
